{% load static %}

</html>
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="{% static 'images/bmw-logo.png' %}">
  <title>BMW Model Hierarchy</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary-blue: #0066ff;
      --light-blue: #00a8ff;
      --dark-blue: #003d99;
      --black: #0a0e27;
      --dark-black: #050810;
      --accent-blue: #00d4ff;
      --text-light: #e0e0e0;
      --text-dim: #999;
    }

    body {
      font-family: 'Times New Roman', Times, serif;
      background: linear-gradient(135deg, var(--dark-black), var(--black));
      min-height: 100vh;
      padding-top: 90px;
      overflow-x: hidden;
      color: #e0e0e0;
    }

    .navbar {
      position: fixed;
      top: 0;
      width: 100%;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 20px rgba(0, 168, 255, 0.25);
      z-index: 1000;
    }

    .nav-container {
      max-width: 1400px;
      margin: auto;
      padding: 16px 40px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .nav-brand {
      font-size: 1.6rem;
      font-weight: 700;
      letter-spacing: 3px;
      background: linear-gradient(135deg, #1c69d4, #00d4ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .nav-menu {
      list-style: none;
      display: flex;
      gap: 32px;
    }

    .nav-menu li a {
      color: #000000;
      text-decoration: none;
      padding: 8px 16px;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .nav-menu li a:hover {
      background: rgba(0, 168, 255, 0.15);
      color: #00d4ff;
    }


    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    .title {
      text-align: center;
      font-size: 3rem;
      margin-bottom: 60px;
      font-weight: 700;
      letter-spacing: 3px;
      background: linear-gradient(135deg, #1c69d4, #00d4ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }


    .flowchart {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0;
    }

    .level {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 40px;
      width: 100%;
      position: relative;
      opacity: 0;
      animation: fadeInUp 0.8s ease forwards;
    }

    .level-1 {
      animation-delay: 0.2s;
      margin-bottom: 0;
    }

    .level-2 {
      animation-delay: 0.6s;
      margin-bottom: 0;
    }

    .level-3 {
      animation-delay: 1s;
      margin-top: 0;
      /* Ensure models appear in their correct horizontal position below parent */
      flex-direction: row;
      justify-content: center;
      gap: 0;
      display: none;
      width: 100%;
    }

    .level-3.active {
      display: flex;
    }

    .node {
      background: linear-gradient(135deg, var(--primary-blue), var(--accent-blue));
      border: 2px solid rgba(0, 168, 255, 0.4);
      border-radius: 18px;
      padding: 20px 32px;
      min-width: 150px;
      text-align: center;
      cursor: pointer;
      backdrop-filter: blur(12px);
      box-shadow: 0 12px 35px rgba(0, 168, 255, 0.2);
      transition: all 0.4s ease;
    }

    .node:hover {
      transform: translateY(-8px) scale(1.05);
      box-shadow: 0 18px 50px rgba(0, 168, 255, 0.45);
      border-color: #00d4ff;
    }

    .node-label {
      font-size: 1.1rem;
      font-weight: 600;
    }


    .category-node {
      background: linear-gradient(135deg, var(--primary-blue), var(--accent-blue));
      color: #ffffff;
      border: 2px solid rgba(255, 255, 255, 0.4);
      box-shadow: 0 10px 35px rgba(28, 105, 212, 0.35);
    }

    .category-node.active {
      background: linear-gradient(135deg, var(--primary-blue), var(--accent-blue));
      transform: scale(1.15);
      box-shadow: 0 15px 50px rgba(0, 212, 255, 0.6);
    }


    .category-node:nth-child(1) {
      animation-delay: 0.7s;
    }

    .category-node:nth-child(2) {
      animation-delay: 0.8s;
    }

    .category-node:nth-child(3) {
      animation-delay: 0.9s;
    }

    .category-node:nth-child(4) {
      animation-delay: 1s;
    }

    .category-node:nth-child(5) {
      animation-delay: 1.1s;
    }

    .model-group {
      position: absolute;
      display: none;
      flex-direction: column;
      align-items: center;
      margin-top: 120px;
    }

    .model-group.active {
      display: flex;
    }

    .models-container {
      display: flex;
      justify-content: center;
      gap: 30px;
      flex-wrap: wrap;
      max-width: 900px;
      /* Add top margin to separate from lines */
      margin-top: 30px;
    }

    .model-node:nth-child(1) {
      animation-delay: 0.1s;
    }

    .model-node:nth-child(2) {
      animation-delay: 0.2s;
    }

    .model-node:nth-child(3) {
      animation-delay: 0.3s;
    }

    .model-node:nth-child(4) {
      animation-delay: 0.4s;
    }

    .connections {
      position: relative;
      display: block;
      pointer-events: none;
    }

    .level-1-connections {
      margin: 20px 0;
    }

    .level-2-connections {
      margin: 20px 0;
      display: none;
    }

    .level-2-connections.active {
      display: block;
    }

    .connection-line {
      stroke: rgba(255, 255, 255, 0.7);
      stroke-width: 3;
      fill: none;
      stroke-linecap: round;
      stroke-dasharray: 1000;
      stroke-dashoffset: 1000;
      animation: drawLine 1s ease forwards;
    }


    /* Animations */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-30px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideDown {
      from {
        transform: translateY(-100%);
      }

      to {
        transform: translateY(0);
      }
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(-50px);
      }

      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes popIn {
      0% {
        opacity: 0;
        transform: scale(0);
      }

      70% {
        transform: scale(1.1);
      }

      100% {
        opacity: 1;
        transform: scale(1);
      }
    }

    @keyframes pulse {

      0%,
      100% {
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
      }

      50% {
        box-shadow: 0 12px 48px rgba(28, 105, 212, 0.4);
      }
    }

    @keyframes rotateQuadrant {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.7;
      }
    }

    @keyframes drawLine {
      to {
        stroke-dashoffset: 0;
      }
    }

    .logo-wrapper {
      position: relative;
      width: 70px;
      height: 70px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .logo-wrapper::before {
      content: "";
      position: absolute;
      inset: 0;
      background: white;
      border-radius: 50%;
      z-index: 0;
    }

    .logo-wrapper img {
      position: relative;
      z-index: 1;
      width: 70px;
      height: 70px;
      object-fit: contain;
    }

    /* ============================
   MODERN BMW ADMIN NAVBAR (Centered Links)
============================ */
    .admin-navbar {
      margin-top: -100px;
      width: 100%;
      padding: 14px 28px;
      background: #f0f0f0;
      color: #130000;

      display: flex;
      justify-content: space-between;
      align-items: center;

      box-shadow: 0 4px 14px rgba(0, 0, 0, 0.3);
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    /* Left: Logo + Title */
    .nav-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    /* CENTER the navbar links */
    .nav-center {
      display: flex;
      justify-content: center;
      flex: 1;
    }

    .nav-links {
      display: flex;
      gap: 24px;
    }

    /* Links */
    .nav-links a {
      color: #000000;
      text-decoration: none;
      font-weight: 600;
      padding: 6px 12px;
      border-radius: 6px;
      transition: 0.2s;
    }

    .nav-links a:hover {
      background: rgba(0, 0, 0, 0.12);
    }

    /* Logout on right */
    .logout-btn {
      margin-right: 2.8rem;
      color: #ff5f5f !important;
      text-decoration: none;
      font-weight: 700;
      padding: 6px 12px;
      border: 1px solid rgba(255, 90, 90, 0.5);
      border-radius: 6px;
    }

    .logout-btn:hover {
      background: #ff4d4d;
      color: #fff !important;
    }

    /* LOGO */
    .nav-logo {
      width: 42px;
      filter: drop-shadow(0 0 4px #007bff55);
    }

    /* Dropdown */
    /* ===== Dropdown ===== */
    .dropdown {
      position: relative;
    }

    .dropdown-toggle {
      cursor: pointer;
    }

    /* Menu */
    .dropdown-menu {
      position: absolute;
      top: 40px;
      left: 0;
      background: #ffffff;
      min-width: 220px;
      border-radius: 10px;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.2);
      display: none;
      flex-direction: column;
      overflow: hidden;
      z-index: 999;
    }

    /* Links */
    .dropdown-menu a {
      padding: 12px 16px;
      text-decoration: none;
      color: #1c69d4;
      font-weight: 500;
      transition: background 0.25s ease;
    }

    .dropdown-menu a:hover {
      background: rgba(28, 105, 212, 0.08);
    }

    /* Active */
    .dropdown-menu.show {
      display: flex;
    }
  </style>
</head>

<body>
  {% if request.user.is_authenticated and request.user.is_staff or request.user.is_superuser %}
  <nav class="admin-navbar">
    <div class="nav-left">
      <img src="{% static 'images/BMW-logo.png' %}" class="nav-logo" alt="BMW">
    </div>
    <div class="nav-center">
      <div class="nav-links">
        <a href="/basemode/dashboard/">Dashboard</a>
        <a href="/basemode/analytics/">Analytics</a>
        <a href="/basemode/graphs/">Graphs</a>
        <a href="/basemode/manage-users/">Users</a>
        <div class="dropdown">
          <a href="javascript:void(0)" class="dropdown-toggle" onclick="togglePrediction()">
            Prediction â–¾
          </a>

          <div class="dropdown-menu" id="predictionMenu">
            <a href="/ml_engine/price/">Price Prediction</a>
            <a href="/ml_engine/sales/">Sales Volume Prediction</a>
            <a href="/ml_engine/likelihood/">Purchase Likelihood</a>
          </div>
        </div>

      </div>
    </div>
    <a href="/logout/" class="logout-btn">Logout</a>
  </nav>

  {% else %}
  <nav class="navbar">
    <div class="nav-container">
      <div class="nav-logo">
        <img src="{% static 'images/BMW-logo.png' %}" alt="logo" style="width: 40px; height: 40px;">
      </div>

      <ul class="nav-menu">
        <li><a href="/">Home</a></li>
        <li><a href="">Models</a></li>
        <li><a href="/drive">Drive</a></li>
        <li><a href="/logout/">Logout</a></li>
      </ul>
    </div>
  </nav>
  {% endif %}


  <div class="container">

    <div class="flowchart" id="flowchart">
      <!-- Level 1: BMW Logo -->
      <div class="level level-1">
        <div class="bmw-logo" id="bmwLogo" style="border: none;">
          <div class="node-label logo-wrapper">
            <img src="{% static 'images/BMW-logo.png' %}" alt="BMW Logo">
          </div>
        </div>
      </div>

      <!-- Dynamic SVG connections will be drawn by JavaScript -->
      <svg class="connections level-1-connections" id="level1SVG" width="100%" height="100"></svg>

      <!-- Level 2: Categories -->
      <div class="level level-2" id="level2">
        <div class="node category-node" data-category="hatchback" data-url="hatchback.html">
          <div class="node-label">Hatchback</div>
        </div>
        <div class="node category-node" data-category="sedan" data-url="sedan.html">
          <div class="node-label">Sedan</div>
        </div>
        <div class="node category-node" data-category="suv" data-url="suv.html">
          <div class="node-label">SUV</div>
        </div>
        <div class="node category-node" data-category="ev" data-url="ev.html">
          <div class="node-label">EV</div>
        </div>
        <div class="node category-node" data-category="convertible" data-url="convertible.html">
          <div class="node-label">Convertible</div>
        </div>
      </div>
      <svg class="connections level-2-connections" id="level2SVG" width="100%" height="80"></svg>
      <div class="level level-3" id="modelsLevel">
        <!-- Hatchback Models -->
        <div class="model-group" data-group="hatchback">
          <div class="models-container">
            <!-- Updated to link to car details page with model parameter -->
            <div class="node model-node" data-url="/1-series/">
              <div class="node-label">1 Series Hatchback</div>
            </div>
          </div>
        </div>

        <!-- Sedan Models -->
        <div class="model-group" data-group="sedan">
          <div class="models-container">
            <!-- Updated all sedan models to link to car details page -->
            <div class="node model-node" data-url="/3-series/">
              <div class="node-label">3 Series</div>
            </div>
            <div class="node model-node" data-url="/5-series/">
              <div class="node-label">5 Series</div>
            </div>
            <div class="node model-node" data-url="/7-series/">
              <div class="node-label">7 Series</div>
            </div>
            <div class="node model-node" data-url="/m3/">
              <div class="node-label">M3</div>
            </div>
            <!-- Added M5 as a sedan model -->
            <div class="node model-node" data-url="/m5/">
              <div class="node-label">M5</div>
            </div>
          </div>
        </div>

        <!-- SUV Models -->
        <div class="model-group" data-group="suv">
          <div class="models-container">
            <!-- Updated all SUV models to link to car details page -->
            <div class="node model-node" data-url="/x1/">
              <div class="node-label">X1</div>
            </div>
            <div class="node model-node" data-url="/x3/">
              <div class="node-label">X3</div>
            </div>
            <div class="node model-node" data-url="/x5/">
              <div class="node-label">X5</div>
            </div>
            <div class="node model-node" data-url="/x6/">
              <div class="node-label">X6</div>
            </div>
          </div>
        </div>

        <!-- EV Models -->
        <div class="model-group" data-group="ev">
          <div class="models-container">
            <!-- Updated all EV models to link to car details page -->
            <div class="node model-node" data-url="/i3/">
              <div class="node-label">i3</div>
            </div>
            <div class="node model-node" data-url="/i8/">
              <div class="node-label">i8</div>
            </div>
          </div>
        </div>

        <!-- Convertible Models -->
        <div class="model-group" data-group="convertible">
          <div class="models-container">
            <!-- Updated to 4 Series Convertible with correct model parameter -->
            <div class="node model-node" data-url="/4-series-convertible/">
              <div class="node-label">4 Series Convertible</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let activeCategory = null

    const categoryNodes = document.querySelectorAll(".category-node")
    const modelsLevel = document.getElementById("modelsLevel")
    const modelGroups = document.querySelectorAll(".model-group")
    const level2SVG = document.getElementById("level2SVG")

    window.addEventListener("load", () => {
      drawLevel1Connections()
    })

    function drawLevel1Connections() {
      const svg = document.getElementById("level1SVG")
      const bmwLogo = document.getElementById("bmwLogo")
      const categories = document.querySelectorAll(".category-node")

      svg.innerHTML = ""

      const logoRect = bmwLogo.getBoundingClientRect()
      const svgRect = svg.getBoundingClientRect()
      const logoX = logoRect.left + logoRect.width / 2 - svgRect.left
      const logoY = 0

      categories.forEach((category, index) => {
        const categoryRect = category.getBoundingClientRect()
        const categoryX = categoryRect.left + categoryRect.width / 2 - svgRect.left
        const categoryY = svgRect.height

        const line = document.createElementNS("http://www.w3.org/2000/svg", "line")
        line.setAttribute("x1", logoX)
        line.setAttribute("y1", logoY)
        line.setAttribute("x2", categoryX)
        line.setAttribute("y2", categoryY)
        line.classList.add("connection-line")
        line.style.animationDelay = `${0.5 + index * 0.1}s`

        svg.appendChild(line)
      })
    }

    function drawLevel2Connections(categoryElement, modelElements) {
      const svg = level2SVG
      svg.innerHTML = ""

      const categoryRect = categoryElement.getBoundingClientRect()
      const svgRect = svg.getBoundingClientRect()
      const categoryX = categoryRect.left + categoryRect.width / 2 - svgRect.left
      const categoryY = 0

      modelElements.forEach((model, index) => {
        const modelRect = model.getBoundingClientRect()
        const modelX = modelRect.left + modelRect.width / 2 - svgRect.left
        const modelY = svgRect.height

        const line = document.createElementNS("http://www.w3.org/2000/svg", "line")
        line.setAttribute("x1", categoryX)
        line.setAttribute("y1", categoryY)
        line.setAttribute("x2", modelX)
        line.setAttribute("y2", modelY)
        line.classList.add("connection-line")
        line.style.animationDelay = `${index * 0.1}s`

        svg.appendChild(line)
      })

      level2SVG.classList.add("active")
    }

    categoryNodes.forEach((categoryNode) => {
      categoryNode.addEventListener("click", function (e) {
        e.stopPropagation()
        const category = this.getAttribute("data-category")

        if (activeCategory === category) {
          hideAllModels()
          return
        }

        showModelsForCategory(category, this)
      })
    })

    function showModelsForCategory(category, clickedNode) {
      categoryNodes.forEach((node) => node.classList.remove("active"))
      clickedNode.classList.add("active")

      modelGroups.forEach((group) => {
        group.classList.remove("active")
      })

      modelsLevel.classList.add("active")

      const targetGroup = document.querySelector(`.model-group[data-group="${category}"]`)
      if (targetGroup) {
        // Position the model group directly below the clicked category
        const clickedRect = clickedNode.getBoundingClientRect()
        const flowchartRect = document.querySelector(".flowchart").getBoundingClientRect()
        const leftPosition = clickedRect.left + clickedRect.width / 2 - flowchartRect.left

        targetGroup.style.left = `${leftPosition}px`
        targetGroup.style.transform = "translateX(-50%)"

        setTimeout(() => {
          targetGroup.classList.add("active")

          const modelNodes = targetGroup.querySelectorAll(".model-node")
          modelNodes.forEach((node, index) => {
            node.style.animation = "none"
            setTimeout(() => {
              node.style.animation = ""
            }, 10)
          })

          setTimeout(() => {
            drawLevel2Connections(clickedNode, modelNodes)
          }, 100)
        }, 100)
      }

      activeCategory = category
    }

    function hideAllModels() {
      categoryNodes.forEach((node) => node.classList.remove("active"))
      modelGroups.forEach((group) => group.classList.remove("active"))
      modelsLevel.classList.remove("active")
      level2SVG.classList.remove("active")
      level2SVG.innerHTML = ""
      activeCategory = null
    }

    document.querySelectorAll(".model-node").forEach((node) => {
      node.addEventListener("click", function (e) {
        e.stopPropagation()
        const url = this.getAttribute("data-url")

        this.style.transform = "scale(0.95)"

        setTimeout(() => {
          window.location.href = url
        }, 200)
      })
    })

    document.querySelector(".bmw-logo").addEventListener("click", function () {
      const url = this.getAttribute("data-url")
      alert(`Redirecting to: ${url}\n\nBMW Main Page`)
      // window.location.href = url;
    })

    categoryNodes.forEach((node) => {
      node.addEventListener("dblclick", function () {
        const url = this.getAttribute("data-url")
        alert(`Double-click detected!\nRedirecting to: ${url}\n\nCategory: ${this.textContent.trim()}`)
        // window.location.href = url;
      })
    })

    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && activeCategory) {
        hideAllModels()
      }

      if (e.key === "Enter") {
        const focusedElement = document.activeElement
        if (focusedElement.classList.contains("node")) {
          focusedElement.click()
        }
      }
    })

    document.querySelectorAll(".node").forEach((node) => {
      node.setAttribute("tabindex", "0")
      node.setAttribute("role", "button")
    })

    window.addEventListener("resize", () => {
      drawLevel1Connections()
      if (activeCategory) {
        const activeNode = document.querySelector(".category-node.active")
        const activeGroup = document.querySelector(".model-group.active")
        if (activeNode && activeGroup) {
          const modelNodes = activeGroup.querySelectorAll(".model-node")
          drawLevel2Connections(activeNode, modelNodes)
        }
      }
    })

    function togglePrediction() {
      document.getElementById("predictionMenu").classList.toggle("show");
    }

    // Close dropdown when clicking outside
    document.addEventListener("click", function (e) {
      const dropdown = document.querySelector(".dropdown");
      if (!dropdown.contains(e.target)) {
        document.getElementById("predictionMenu").classList.remove("show");
      }
    });

  </script>
</body>

</html>